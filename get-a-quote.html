<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Custom Web Design Quote for Aviation Firms | Webwing Agency</title>

  <!-- YOUR CSS -->
  <link rel="preload" href="css/global.css" as="style" />
  <link rel="preload" href="css/quote.css" as="style" />
  <link rel="stylesheet" href="css/global.css">
  <link rel="stylesheet" href="css/quote.css">

  <!-- GSAP / Barba / Your other components -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.7/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@barba/core"></script>
  <script src="https://unpkg.com/@barba/head/dist/barba-head.umd.js"></script>
  <script src="js/components/cta.js"></script>
  <script src="js/components/nav.js"></script>
  <script src="js/components/footer.js"></script>

  <link rel="icon" href="assets/icons/favicon.svg" type="image/png" />
</head>
<body data-barba="wrapper">
  <header>
    <nav id="standard-nav"></nav>
  </header>

  <main data-barba="container">
    <section class="quote-section">
      <div class="quote-wrapper">
        <!-- "Step X of Y" label (hidden until Start is clicked) -->
        <span class="form-step hidden">Step 1 of 8</span>

        <!-- Progress‐bar (hidden until Start is clicked) -->
        <div class="progress-bar hidden">
          <div id="progress" class="progress-fill"></div>
        </div>

        <!-- Intro heading (hides once form appears) -->
        <h1 class="quote-heading">Get a Tailored Quote</h1>

        <!-- START SCREEN -->
        <div id="startScreen" class="fade active start-screen">
          <p class="start-text">
            Click below to get a custom quote by answering 8 simple questions.
            Book a discovery call afterwards to kickstart our collaboration.
          </p>
          <button id="startBtn" class="large-cta">
            <span>Start</span>
          </button>
        </div>

        <!-- MULTI‐STEP FORM (initially hidden) -->
        <form id="quoteForm" class="quote-form hidden" autocomplete="off">
          <!-- STEP 1 -->
          <div class="step fade hidden">
            <label class="step-title mb">Project Type</label>
            <p class="step-subtitle">What do you need?</p>
            <div class="step-content">
              <div class="radio-group">
                <input type="radio" id="proj-website" name="projectType" value="websiteRedesign" required />
                <label for="proj-website" class="radio-option">Redesign</label>
                <input type="radio" id="proj-landing" name="projectType" value="newWebsite" />
                <label for="proj-landing" class="radio-option">New Site</label>
                <input type="radio" id="proj-other" name="projectType" value="other" />
                <label for="proj-other" class="radio-option">Other</label>
              </div>
            </div>
          </div>

          <!-- STEP 2 -->
          <div class="step fade hidden">
            <label class="step-title mb">Number of Pages</label>
            <p class="step-subtitle">How many pages you need</p>
            <div class="step-content">
              <div class="radio-group">
                <input type="radio" id="pages-1-5"   name="pages" value="1-5" required />
                <label for="pages-1-5" class="radio-option">1–5</label>
                <input type="radio" id="pages-10-20" name="pages" value="10-20" />
                <label for="pages-10-20" class="radio-option">10–20</label>
                <input type="radio" id="pages-20-plus" name="pages" value="20+" />
                <label for="pages-20-plus" class="radio-option">20+</label>
              </div>
            </div>
          </div>

          <!-- STEP 3 -->
          <div class="step fade hidden">
            <label class="step-title">Desired Timeline</label>
            <p class="step-subtitle">When you need completion</p>
            <div class="step-content">
              <input 
                type="range" 
                name="timeline" 
                id="timeline" 
                required 
                class="input slider" 
                min="2" max="10" step="1"
              />
              <span id="timeline-label"></span>
            </div>
          </div>

          <!-- STEP 4 -->
          <div class="step fade hidden">
            <label class="step-title">Additional Notes</label>
            <p class="step-subtitle">Any extra details here</p>
            <div class="step-content">
              <textarea 
                name="additionalNotes" 
                rows="4" 
                required 
                class="input textarea" 
                placeholder="Anything you still want to add or tell us?"
              ></textarea>
            </div>
          </div>

          <!-- STEP 5 -->
          <div class="step fade hidden">
            <label class="step-title">Your Business</label>
            <p class="step-subtitle">Your company’s name</p>
            <div class="step-content">
              <input 
                type="text" 
                name="business" 
                required 
                class="input" 
                placeholder="Tell us the name of your business"
              />
            </div>
          </div>

          <!-- STEP 6 -->
          <div class="step fade hidden">
            <label class="step-title">Your Website</label>
            <p class="step-subtitle">Your company’s website</p>
            <div class="step-content">
              <input 
                type="url" 
                name="website" 
                required 
                class="input" 
                placeholder="Tell us URL of your business’ website" 
                value="https://"
              />
            </div>
          </div>

          <!-- STEP 7 -->
          <div class="step fade hidden">
            <label class="step-title">Your Name</label>
            <p class="step-subtitle">Who to address quote to</p>
            <div class="step-content">
              <input 
                type="text" 
                name="name" 
                required 
                class="input" 
                placeholder="Your name"
              />
            </div>
          </div>

          <!-- STEP 8 -->
          <div class="step fade hidden">
            <label class="step-title">Your Email</label>
            <p class="step-subtitle">Where we’ll send it</p>
            <div class="step-content">
              <input 
                type="email" 
                name="email" 
                required 
                class="input" 
                placeholder="Your email"
              />
            </div>
          </div>

          <!-- FINAL STEP: BOOK MEETING -->
          <div class="step fade hidden text-center">
            <label class="step-title">Final Step</label>
            <p class="step-subtitle">
              After you’ve booked a discovery call with us, we will send you a project cost & time estimate,
              which we can discuss further during the call. Book now.
            </p>
            <div class="step-content">
              <button
                id="book-meeting"
                class="book-meeting-button cal-trigger-button"
                type="button"
              >
                Schedule Discovery Call
              </button>
            </div>
          </div>

          <!-- FORM NAVIGATION (Previous / Next) -->
          <div class="form-footer">
            <button 
              id="prevBtn" 
              type="button" 
              class="previous-button mt-2 text-white text-opacity-25 hover:text-opacity-40"
            >
              Previous
            </button>
            <button 
              id="nextBtn" 
              type="button" 
              class="next-button"
            >
              Continue
              <div class="arrow-container">
                <svg class="arrow" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                </svg>
              </div>
            </button>
          </div>
        </form>
      </div>

      <!-- Decorative Circles (background) -->
      <div class="bg-wrapper">
        <div class="circle purple"></div>
        <div class="circle pink"></div>
      </div>
      <div class="background-orb"></div>
      <img class="bg-dot-gradient" src="assets/dot-gradient.svg" alt="Decorative background dot gradient pattern" />
    </section>
  </main>

  <footer id="standard-footer"></footer>


  <script src="js/quote.js" defer></script>

  <script src="js/barba.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.0/ScrollTrigger.min.js" defer></script>
  <script src="js/gsap/gsap-quote.js" defer></script>

  <script>
     // ──────────────────────────────────────────────────────────────────────────
// 1) INITIALIZE window.Cal queue + config
// ──────────────────────────────────────────────────────────────────────────
window.Cal = window.Cal || function() {
  (window.Cal.q = window.Cal.q || []).push(arguments);
};
window.Cal.config = window.Cal.config || {};
window.Cal.config.forwardQueryParams = true;

// ──────────────────────────────────────────────────────────────────────────
// 2) INJECT Cal.com EMBED SCRIPT & set up a “ready” callback
// ──────────────────────────────────────────────────────────────────────────
(function (global, embedUrl, INIT_CMD) {
  const d = global.document;
  global.Cal = global.Cal || function() {
    const calFn = global.Cal;
    const args = arguments;
    if (!calFn.loaded) {
      // Append <script src="…embed.js"> to <head>
      const s = d.createElement("script");
      s.src = embedUrl;
      s.async = true;
      d.head.appendChild(s);
      calFn.loaded = true;
    }
    // If first argument is "init", we queue it under its namespace
    if (args[0] === INIT_CMD) {
      // Create a mini-“API” focusing on namespaces
      const namespaceName = args[1];
      const api = function() { api.q.push(arguments); };
      api.q = api.q || [];
      if (typeof namespaceName === "string") {
        // Ensure we have a namespaces object
        calFn.ns = calFn.ns || {};
        calFn.ns[namespaceName] = calFn.ns[namespaceName] || api;
        api.q.push(args);               // queue the init call (+options)
        calFn.q.push(["initNamespace", namespaceName]); // notify main queue
      } else {
        // If they passed something else to Cal("init", …), just queue it
        calFn.q.push(args);
      }
      return;
    }
    // Everything else just gets queued onto Cal.q
    calFn.q.push(args);
  };
})(window,
   "https://app.cal.com/embed/embed.js",
   "init"
);

// ──────────────────────────────────────────────────────────────────────────
// 3) WAIT FOR DOM → THEN attach your “Book” listener
// ──────────────────────────────────────────────────────────────────────────
document.addEventListener("DOMContentLoaded", () => {

  // 3.a) Grab your “Book” button
  const bookMeetingBtn = document.getElementById("book-meeting");
  if (!bookMeetingBtn) {
    console.warn("No element with ID 'book-meeting' found.");
    return;
  }

  // 3.b) Before anything else, queue up Cal.init under a namespace “discovery-call”.
  //       We do this so that when the script actually loads, it sees this in the queue.
  Cal("init", "discovery-call", {
    origin: "https://cal.com",
    // If you had a redirect URL built into Cal itself, you could do:
    // redirectUrl: "https://your-domain.com/quote-confirmation.html"
    // but in our case, we’ll handle redirect manully via the event listener below.
  });

  // 3.c) Event-listener for “Book a Meeting”
  book-meetingBtn.addEventListener("click", () => {
    // ───────────────────────────────────────────────────────────────────────
    // a) Collect + validate form inputs
    // ───────────────────────────────────────────────────────────────────────
    const nameInput   = document.querySelector('input[name="name"]');
    const emailInput  = document.querySelector('input[name="email"]');
    const projectType = document.querySelector('input[name="projectType"]:checked')?.value;
    const pages       = document.querySelector('input[name="pages"]:checked')?.value;
    const timeline    = document.getElementById('timeline')?.value;
    const notes       = document.querySelector('textarea[name="additionalNotes"]')?.value.trim();
    const business    = document.querySelector('input[name="business"]')?.value.trim();
    const website     = document.querySelector('input[name="website"]')?.value.trim();

    const name  = nameInput?.value.trim();
    const email = emailInput?.value.trim();

    if (!name || !email || !projectType || !pages || !timeline) {
      return alert("Please fill in all required fields before booking.");
    }

    // ───────────────────────────────────────────────────────────────────────
    // b) Build our internal “quoteData” payload (for the confirmation page)
    // ───────────────────────────────────────────────────────────────────────
    const quoteData = {
      requesterName:   name,
      requesterEmail:  email,
      projectType,
      pages,
      timelineWeeks:   Number(timeline),
      additionalNotes: notes,
      business,
      website,
      estimatedPrice:  calculatePrice()
    };

    // Build the “redirect → /quote-confirmation.html” URL including query-params
    const params      = new URLSearchParams(quoteData).toString();
    const ourRedirect = `${window.location.origin}/quote-confirmation.html?${params}`;

    // ───────────────────────────────────────────────────────────────────────
    // c) Build the Cal.com booking URL (Name + Email + metadata JSON)
    // ───────────────────────────────────────────────────────────────────────
    // Convert quoteData.except name/email into metadata (JSON → URI-encoded)
    const metadataObj = {
      projectType,
      pages,
      timelineWeeks:   Number(timeline),
      additionalNotes: notes,
      business,
      website,
      estimatedPrice:    quoteData.estimatedPrice
    };
    const encodedMetadata = encodeURIComponent(JSON.stringify(metadataObj));

    const calBookUrl = 
      `https://cal.com/webwing-agency/discovery-call`
      + `?name=${encodeURIComponent(name)}`
      + `&email=${encodeURIComponent(email)}`
      + `&metadata=${encodedMetadata}`;

    // ───────────────────────────────────────────────────────────────────────
    // d) Set up a one-time “bookingSuccessful” listener _before_ opening the widget
    // ───────────────────────────────────────────────────────────────────────
    const onBooking = (event) => {
      // Unregister listener so it only fires once
      Cal("off", { action: "bookingSuccessful", callback: onBooking });
      // Now redirect to our own confirmation page
      window.location.href = ourRedirect;
    };
    Cal("on", { action: "bookingSuccessful", callback: onBooking });

    // ───────────────────────────────────────────────────────────────────────
    // e) Open the Cal.com popup-widget with full metadata
    // ───────────────────────────────────────────────────────────────────────
    Cal("ui", {
      theme:                "light",
      layout:               "month_view",
      hideEventTypeDetails: false,
      url:                  calBookUrl
      // If you wanted Cal itself to auto-redirect after booking, you could also pass:
      // redirectUrl: ourRedirect
    });

  }); // end click listener

}); // end DOMContentLoaded



// ──────────────────────────────────────────────────────────────────────────
// 4) PRICING FUNCTION (unchanged except for minor clean-up)
// ──────────────────────────────────────────────────────────────────────────
function calculatePrice() {
  const projectType = document.querySelector('input[name="projectType"]:checked')?.value;
  const pages       = document.querySelector('input[name="pages"]:checked')?.value;
  const timeline    = Number(document.getElementById('timeline')?.value);

  let basePrice = 20000;
  if (projectType === 'websiteRedesign') basePrice = 15000;
  else if (projectType === 'newWebsite')   basePrice = 20000;

  let pagesPrice = 0;
  switch (pages) {
    case '1-5':   pagesPrice = 5000;  break;
    case '10-20': pagesPrice = 12000; break;
    case '20+':   pagesPrice = 20000; break;
    default:      pagesPrice = 0;     break;
  }

  let timelinePrice = (timeline <= 4) ? ((5 - timeline) * 4000) : 0;
  let totalPrice    = basePrice + pagesPrice + timelinePrice;
  // Enforce min/max
  totalPrice = Math.max(30000, Math.min(200000, totalPrice));

  return totalPrice;
}

  </script>
</body>
</html>
